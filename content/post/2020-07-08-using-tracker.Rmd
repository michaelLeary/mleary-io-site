---
title: 'using trackeR '
author: michael
date: '2020-07-08'
slug: using-tracker
categories:
  - R
tags:
  - Fitness
  - Garmin
---

In this report have used CRAN's trackeR package to further explore fitness data generated by garmin devices. The trackeR package provides a simple means to extract and manipulate the tcx file that can be downloaded from Garmin's connect site. We have replicated some of the examples provided by the package authors with personal data to see how it works.

A 2017 research [article in the Journal of Statistical Software](https://www.jstatsoft.org/article/view/v082i07) provides greater insight into the package's functionality. Besides the package function the article suggests that the open source [Golden Cheetah software](http://www.goldencheetah.org/#section-science) is useful for data analysis. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r pkgs, include=FALSE}
pkgs = c("trackeR", "dplyr") 
install.packages(pkgs, repos="https://cran.r-project.org")
inst = lapply(pkgs, library, character.only = TRUE) #load packages
```

```{r, include=FALSE}
# list files in a directory and save to a variable
my_files <- list.files("~/Documents/GitHub/fitness/data/activitydata/", "\\.tcx$")
print(my_files)
```

```{r, include=FALSE}
#my_files <- my_files[-c(1:7)]
my_files

```

```{r, include=FALSE}
Tr1 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_4366404733.tcx", type = "tcx")
Tr2 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_4393819687.tcx", type = "tcx")
Tr3 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_4939679277.tcx", type = "tcx")
Tr4 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5014148644.tcx", type = "tcx")
Tr5 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5015622806.tcx", type = "tcx")
Tr6 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5018082676.tcx", type = "tcx")
Tr7 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5029699141.tcx", type = "tcx")
Tr8 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5032894001.tcx", type = "tcx")
Tr9 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5189539717.tcx", type = "tcx")
Tr10 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5189539746.tcx", type = "tcx")
Tr11 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5194954646.tcx", type = "tcx")
Tr12 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5201170048.tcx", type = "tcx")
Tr13 <- read_container("~/Documents/GitHub/fitness/data/activitydata/activity_5204582358.tcx", type = "tcx")

```

```{r, include=FALSE}
# merge lists into 1 
ml_act_run <- do.call(c, list(Tr1, Tr2,Tr4,Tr5,Tr8,Tr10,Tr13))
ml_act_bike <- do.call(c, list(Tr3,Tr6,Tr7,Tr9,Tr11,Tr12))

```

```{r, include=FALSE}
getUnits(ml_act_bike)
```

\newpage

## Run activity

```{r rundata, echo=FALSE, message=FALSE}
#data(ml_act_run, package = "trackeR")
plot(ml_act_run, session = 1:7)
```

```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 1, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 1, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```

```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 2, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 2, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 3, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 3, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 4, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 4, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 5, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 5, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 6, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 6, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_run, session = 7, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_run, session = 7, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE}
tryCatch(leaflet_route(ml_act_run, session = c(1:7)),
         error = function(x) "Failed to donwload map data")
```

```{r, echo=FALSE}
summary(ml_act_run, session = 1:7, moving_threshold = c(cycling = 2, running = 1, swimming = 0.5))
```

```{r, echo=FALSE}
runs_summary <- summary(ml_act_run)
plot(runs_summary, group = c("total", "moving"),
     what = c("avgSpeed", "distance", "duration", "avgHeartRate"))
```

```{r, include=FALSE}
# script looking for 26 activities
#timeline(runs_summary)
```

```{r, echo=FALSE}
run_zones <- zones(ml_act_run[1:7], what = "speed", breaks = c(0, 2:6, 12.5))
plot(run_zones)
```

```{r, echo=FALSE}
d_profile <- distribution_profile(ml_act_run, session = 1:7, what = c("speed"), grid = list(speed = seq(0, 12.5, by = 0.05)))
plot(d_profile, multiple = TRUE)
```

```{r, echo=FALSE}
c_profile <- concentrationProfile(d_profile, what = "speed")
plot(c_profile, multiple = TRUE, smooth = TRUE)
```

```{r, echo=FALSE}
runsT <- threshold(ml_act_run)
dp_runs <- distribution_profile(runsT, what = "speed")
dp_runs_S <- smoother(dp_runs)
cp_runs <- concentration_profile(dp_runs_S)
plot(cp_runs, multiple = TRUE, smooth = FALSE)
```

```{r, echo=FALSE}
cpPCA <- funPCA(cp_runs, what = "speed", nharm = 4)
```

```{r, echo=FALSE}
round(cpPCA$varprop, 2)
#> [1] 0.66 0.25 0.06 0.02
plot(cpPCA, harm = 1:2)
```

```{r, echo=FALSE}
## plot scores vs summary statistics
scoresSP <- data.frame(cpPCA$scores)
names(scoresSP) <- paste0("speed_pc", 1:4)
d <- cbind(runs_summary, scoresSP)

library("ggplot2")
## pc1 ~ session duration (moving)
ggplot(d) + geom_point(aes(x = as.numeric(durationMoving), y = speed_pc1)) + theme_bw()
## pc2 ~ avg speed (moving)
ggplot(d) + geom_point(aes(x = avgSpeedMoving, y = speed_pc2)) + theme_bw()
```

\newpage

Bike activity

```{r, echo=FALSE, message=FALSE}
#data(ml_act_bike, package = "trackeR")
plot(ml_act_bike, session = 1:6)
```

```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 1, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 1, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```

```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 2, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 2, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 3, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 3, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 4, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 4, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 5, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 5, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
plot(ml_act_bike, session = 6, what = c("altitude", "pace"))

```

```{r, echo=FALSE, message=FALSE}
tryCatch(plot_route(ml_act_bike, session = 6, source = "stamen"),
         error = function(x) "Failed to donwload map data")
```


```{r, echo=FALSE, message=FALSE}
tryCatch(leaflet_route(ml_act_bike, session = c(1:6)),
         error = function(x) "Failed to donwload map data")
```

```{r, echo=FALSE}
summary(ml_act_bike, session = 1:6, moving_threshold = c(cycling = 2, running = 1, swimming = 0.5))
```

```{r, echo=FALSE}
runs_summary <- summary(ml_act_bike)
plot(runs_summary, group = c("total", "moving"),
     what = c("avgSpeed", "distance", "duration", "avgHeartRate"))
```

```{r, include=FALSE}
# script looking for 26
#timeline(runs_summary)
```

```{r, echo=FALSE}
run_zones <- zones(ml_act_bike[1:6], what = "speed", breaks = c(0, 2:6, 12.5))
plot(run_zones)
```

```{r, include=FALSE}
# not functioning - version calls for 2012 or 2015
#wexp <- Wprime(ml_act_runs, session = 3, quantity = "expended", cp = 4, version = "2015")
#plot(wexp, scaled = TRUE)
```

```{r, echo=FALSE}
d_profile <- distribution_profile(ml_act_bike, session = 1:6, what = "speed",
                                  grid = list(speed = seq(0, 12.5, by = 0.05)))
plot(d_profile, multiple = TRUE)
```

```{r, echo=FALSE}
c_profile <- concentrationProfile(d_profile, what = "speed")
plot(c_profile, multiple = TRUE, smooth = TRUE)
```

```{r, echo=FALSE}
runsT <- threshold(ml_act_bike)
dp_runs <- distribution_profile(runsT, what = "speed")
dp_runs_S <- smoother(dp_runs)
cp_runs <- concentration_profile(dp_runs_S)
plot(cp_runs, multiple = TRUE, smooth = FALSE)
```

```{r, include=FALSE}
cpPCA <- funPCA(cp_runs, what = "speed", nharm = 4)
```

```{r, echo=FALSE}
round(cpPCA$varprop, 2)
#> [1] 0.66 0.25 0.06 0.02
plot(cpPCA, harm = 1:2)
```

```{r, echo=FALSE}
## plot scores vs summary statistics
scoresSP <- data.frame(cpPCA$scores)
names(scoresSP) <- paste0("speed_pc", 1:4)
d <- cbind(runs_summary, scoresSP)

library("ggplot2")
## pc1 ~ session duration (moving)
ggplot(d) + geom_point(aes(x = as.numeric(durationMoving), y = speed_pc1)) + theme_bw()
## pc2 ~ avg speed (moving)
ggplot(d) + geom_point(aes(x = avgSpeedMoving, y = speed_pc2)) + theme_bw()
```







